<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spring.membership.com.main.MainMapper">

	<select id="selNameUser" resultType="UserDomain">
		SELECT * FROM usertable
		WHERE user_name = #{user_name} AND ph = #{ph}
	</select>

	<select id="selIdUser" resultType="UserDomain">
		SELECT * FROM usertable
		WHERE
		id = #{id}
	</select>

	<select id="selRelationUser" resultType="RelationDTO">
		SELECT * FROM
		relationtable
		WHERE i_userFrom = #{i_userFrom} AND i_userTo =
		#{i_userTo};
	</select>

	<insert id="insFriendFrom">
		INSERT INTO relationtable
		(i_userFrom, i_userTo)
		VALUES
		(#{i_userFrom} , #{i_userTo})
	</insert>

	<insert id="insFriendTo">
		INSERT INTO relationtable
		(i_userFrom, i_userTo)
		VALUES
		(#{i_userTo} , #{i_userFrom})
	</insert>

	<select id="selFriendList" resultType="RelationDomain">
		SELECT a.i_userFrom,
		b.i_user, b.nick, b.user_name, b.ph, b.stateMes from relationtable a
		LEFT JOIN usertable b
		ON a.i_userTo = b.i_user
		WHERE a.i_userFrom =
		#{i_userFrom};
	</select>

	<select id="searchUserList" resultType="RelationDomain">
		SELECT a.i_userFrom,
		b.i_user, b.nick, b.user_name, b.ph, b.stateMes from relationtable a
		LEFT JOIN
		usertable b
		ON a.i_userTo = b.i_user
		WHERE a.i_userFrom = #{i_userFrom}
		AND user_name LIKE CONCAT('%', #{user_name}, '%');
	</select>

	<select id="searchUserCount" resultType="RelationDomain">
		SELECT count(i_userTo)
		as friendCount from relationtable a
		LEFT JOIN usertable b
		ON a.i_userTo = b.i_user
		WHERE a.i_userFrom = #{i_userFrom}
		AND user_name LIKE
		CONCAT('%', #{user_name}, '%');
	</select>

	<select id="selFriendCount" resultType="RelationDomain">
		SELECT COUNT(i_userTo) as
		friendCount
		FROM relationtable
		WHERE i_userFrom = #{i_userFrom};
	</select>



	<delete id="delFriendFrom">
		DELETE FROM relationtable
		WHERE i_userFrom =
		#{i_userFrom} and i_userTo = #{i_userTo}
	</delete>

	<delete id="delFriendTo">
		DELETE FROM relationtable
		WHERE i_userFrom =
		#{i_userTo} and i_userTo = #{i_userFrom}
	</delete>

</mapper>





